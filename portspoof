# Check if WSL is available
if (!(Get-WindowsOptionalFeature -Online -FeatureName "Microsoft-Windows-Subsystem-Linux").State -eq "Enabled") {
    # Enable WSL
    Write-Host "Enabling Windows Subsystem for Linux..."
    Enable-WindowsOptionalFeature -Online -FeatureName "Microsoft-Windows-Subsystem-Linux" -NoRestart

    # Restart the computer to apply changes
    Write-Host "Restarting the computer to apply changes..."
    Restart-Computer
}

# Check if Ubuntu is installed
if (!(Get-AppxPackage -Name "CanonicalGroupLimited.Ubuntu*")) {
    # Download Ubuntu Appx file from GitHub
    Write-Host "Downloading Ubuntu Appx file..."
    $ubuntu_url = "https://aka.ms/wslubuntu2004"
    $webclient = New-Object System.Net.WebClient
    try {
        $webclient.DownloadFile($ubuntu_url, "Ubuntu.appx")
    }
    catch {
        Write-Host "Error: Failed to download the Ubuntu Appx file. Please check your network connection or try again later."
        exit
    }

    # Install Ubuntu
    Write-Host "Installing Ubuntu..."
    try {
        Add-AppxPackage -Path "Ubuntu.appx"
    }
    catch {
        Write-Host "Error: Failed to install Ubuntu. Please install it manually from the Microsoft Store."
        Remove-Item "Ubuntu.appx"
        exit
    }
    
    # Remove the downloaded Appx file
    Remove-Item "Ubuntu.appx"

    # Launch Ubuntu and wait for the setup to complete
    Write-Host "Launching Ubuntu for the first time to complete the setup. Please follow the prompts."
    Start-Process -FilePath "ubuntu.exe"
    Write-Host "Press Enter after Ubuntu setup is complete."
    Read-Host
}

# Continue with the rest of the original script...
