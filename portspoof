# Check if WSL is available
if (!(Get-WindowsOptionalFeature -Online -FeatureName "Microsoft-Windows-Subsystem-Linux").State -eq "Enabled") {
    # Enable WSL
    Write-Host "Enabling Windows Subsystem for Linux..."
    Enable-WindowsOptionalFeature -Online -FeatureName "Microsoft-Windows-Subsystem-Linux" -NoRestart

    # Restart the computer to apply changes
    Write-Host "Restarting the computer to apply changes..."
    Restart-Computer
}

# Check if Ubuntu is installed
if (!(Get-AppxPackage -Name "CanonicalGroupLimited.Ubuntu*")) {
    # Download Ubuntu Appx file from GitHub
    Write-Host "Downloading Ubuntu Appx file..."
    $ubuntu_url = "https://github.com/microsoft/WSL-DistroLauncher-Ubuntu/releases/download/2004.2021.825.0/CanonicalGroupLimited.Ubuntu20.04onWindows_2004.2021.825.0_arm64__79rhkp1fndgsc.Appx"
    Invoke-WebRequest -Uri $ubuntu_url -OutFile "Ubuntu.appx" -UseBasicParsing

    # Install Ubuntu
    Write-Host "Installing Ubuntu..."
    try {
        Add-AppxPackage -Path "Ubuntu.appx"
    }
    catch {
        Write-Host "Error: Failed to install Ubuntu. Please install it manually from the Microsoft Store."
        Remove-Item "Ubuntu.appx"
        exit
    }
    
    # Remove the downloaded Appx file
    Remove-Item "Ubuntu.appx"

    # Launch Ubuntu and wait for the setup to complete
    Write-Host "Launching Ubuntu for the first time to complete the setup. Please follow the prompts."
    Start-Process -FilePath "ubuntu.exe"
    Write-Host "Press Enter after Ubuntu setup is complete."
    Read-Host
}

# Continue with the rest of the original script...
